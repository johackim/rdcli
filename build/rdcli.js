#!/usr/bin/env node
'use strict';require('babel-polyfill');var _commander=require('commander');var _commander2=_interopRequireDefault(_commander);var _coPrompt=require('co-prompt');var _coPrompt2=_interopRequireDefault(_coPrompt);var _ora=require('ora');var _ora2=_interopRequireDefault(_ora);var _co=require('co');var _co2=_interopRequireDefault(_co);var _chalk=require('chalk');var _chalk2=_interopRequireDefault(_chalk);var _fs=require('fs');var _fs2=_interopRequireDefault(_fs);var _download=require('./download');var _torrent=require('./torrent');var _unrestrict=require('./unrestrict');var _unrestrict2=_interopRequireDefault(_unrestrict);var _connect=require('./connect');var _connect2=_interopRequireDefault(_connect);var _package=require('../package.json');var _package2=_interopRequireDefault(_package);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}_commander2.default.version(_package2.default.version).description('Download links, magnets and torrent files.').usage('<url|magnet|torrent>').action(function(arg){return(0,_co2.default)(regeneratorRuntime.mark(function action(){var username,password,token,link,unrestrictLink,spinner;return regeneratorRuntime.wrap(function action$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return(0,_coPrompt2.default)('Username: ');case 3:username=_context.sent;_context.next=6;return _coPrompt2.default.password('Password: ');case 6:password=_context.sent;_context.next=9;return(0,_connect2.default)(username,password);case 9:token=_context.sent;link=void 0;if(!arg.match(/^(https?:\/\/)([\da-z.-]+).([a-z.]{2,6})([/\w? .-]*)*\/?$/)){_context.next=15;break;}link=arg;_context.next=23;break;case 15:if(!(arg.match(/^magnet:\?xt=urn:[a-z0-9]+:[a-z0-9]{20,50}/i)||_fs2.default.existsSync(arg))){_context.next=21;break;}_context.next=18;return(0,_torrent.convertTorrent)(arg,token);case 18:link=_context.sent;_context.next=23;break;case 21:console.log('Usage: rdcli <url|magnet|torrent>');process.exit();case 23:_context.next=25;return(0,_unrestrict2.default)(link,token);case 25:unrestrictLink=_context.sent;console.log('Start download : '+unrestrictLink);_context.next=29;return(0,_download.waitDuringScan)(link);case 29:spinner=(0,_ora2.default)('Download: 0.0% Speed: 0Mbps').start();(0,_download.download)(unrestrictLink,function(res){if(res.percent){spinner.text='Download: '+res.percent+'% Speed: '+res.mbps+' '+res.bytesWriting+'/'+res.totalSize+' Remaining: '+res.remaining+'sec';// eslint-disable-line max-len
}else if(res==='end'){spinner.stop();console.log('File downloaded.');}else{spinner.stop();console.log('Error: '+res);}});_context.next=37;break;case 33:_context.prev=33;_context.t0=_context['catch'](0);console.error('\n'+_chalk2.default.red(_context.t0));process.exit();case 37:case'end':return _context.stop();}}},action,this,[[0,33]]);}));}).parse(process.argv);if(!process.argv.slice(2).length){_commander2.default.outputHelp();}